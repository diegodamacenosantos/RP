<template>
    <div class="smart-btn" :class="{ 'smart-btn-active': isActive }" @click="alternar" v-ripple>
        <div class="sb-header">
            <span class="sb-title">{{ config.label }}</span>
        </div>

        <div class="sb-icon-container">
            <v-icon class="sb-icon" :color="iconColor" size="32">
                {{ config.icon }}
            </v-icon>
        </div>

        <div class="sb-status">
            <span :class="{ 'sb-text-glow': isActive }">
                {{ isActive ? 'ON' : 'OFF' }}
            </span>
        </div>

        <div class="sb-glow" v-if="isActive"></div>
    </div>
</template>

<script>
    export default {
    data() {
        return {
            // === CONFIGURAÇÃO ===
            // https://pictogrammers.com/library/mdi
            config: {
                id: "a1",
                label: "Quarto",
                icon: "mdi-bed"   
            },
            // ====================
            isActive: false
        };
    },
    computed: {
        iconColor() {
            return this.isActive ? '#ffffff' : '#9E9E9E';
        }
    },
    mounted() {
        const savedStatus = localStorage.getItem(this.config.id + '_status');
        if (savedStatus === 'ON') {
            this.isActive = true;
        } else {
            this.isActive = false;
        }
    },
    methods: {
        alternar() {
            if (this.isActive) {
                this.off_alternar();    
            } else {
                this.on_alternar();
            }
        },
        on_alternar() {
            this.isActive = true;
            this.saveOne("ON");
            this.send({ payload: "ON" });
        },
        off_alternar() {
            this.isActive = false;
            this.saveOne("OFF");
            this.send({ payload: "OFF" });
        },
        on() {
            this.isActive = true;
            this.saveOne("ON");
        },
        off() {
            this.isActive = false;
            this.saveOne("OFF");
        },
        saveOne(status) {
            localStorage.setItem(this.config.id + '_status', status);
        }
    },
    watch: {
        msg: function() {
            if (!this.msg) return;
            
            if (this.msg.payload === "ON") {
                this.on();
            } else if (this.msg.payload === "OFF") {
                this.off();
            }
        }
    }
}
</script>

<style scoped>
    .smart-btn {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        margin: auto;
        height: 90px !important;
        width: 90px !important;
        background: linear-gradient(145deg, #1e1e1e, #252525);
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5), -2px -2px 10px rgba(255, 255, 255, 0.05);
        overflow: hidden;
        user-select: none;
    }

    .smart-btn:hover {
        transform: translateY(-2px);
        border-color: rgba(255, 255, 255, 0.25);
        box-shadow: 8px 8px 15px rgba(0, 0, 0, 0.6), -2px -2px 10px rgba(255, 255, 255, 0.08);
    }

    
    .smart-btn.smart-btn-active {
        background: linear-gradient(145deg, #2E7D32, #1B5E20);
        border-color: #4CAF50;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4), inset 0 0 10px rgba(255, 255, 255, 0.1);
    }

    .sb-header {
        display: flex;
        justify-content: flex-start;
        padding-left: 8px;
        padding-top: 8px;
        z-index: 2;
    }

    .sb-title {
        font-size: 10px;
        font-weight: 700;
        color: #9e9e9e;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: color 0.3s;
    }

    .smart-btn-active .sb-title {
        color: rgba(255, 255, 255, 0.9);
    }

    .sb-icon-container {
        display: flex;
        justify-content: center;
        align-items: center;
        flex: 1;
        z-index: 2;
    }

    .sb-icon {
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    .smart-btn-active .sb-icon {
        transform: scale(1.15);
        filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5));
    }

    .sb-status {
        text-align: center;
        font-size: 9px;
        font-weight: 700;
        color: #666;
        padding-bottom: 8px;
        letter-spacing: 0.5px;
        z-index: 2;
        transition: color 0.3s;
    }

    .smart-btn-active .sb-status {
        color: #fff;
    }

    .sb-text-glow {
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
    }

    .sb-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60%;
        height: 60%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
        filter: blur(8px);
        z-index: 1;
        pointer-events: none;
        animation: sb-pulse 2s infinite;
    }

    @keyframes sb-pulse {
        0% {
            opacity: 0.5;
            transform: translate(-50%, -50%) scale(0.95);
        }

        50% {
            opacity: 0.8;
            transform: translate(-50%, -50%) scale(1.1);
        }

        100% {
            opacity: 0.5;
            transform: translate(-50%, -50%) scale(0.95);
        }
    }

    .smart-btn:active {
        transform: scale(0.96);
    }
</style>
